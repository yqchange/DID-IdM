!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("elliptic"),require("did-jwt"),require("did-jwt-vc"),require("ethr-did-resolver"),require("web-did-resolver"),require("did-resolver"),require("mnid")):"function"==typeof define&&define.amd?define(["exports","elliptic","did-jwt","did-jwt-vc","ethr-did-resolver","web-did-resolver","did-resolver","mnid"],r):r((e=e||self).uportCredentials={},e.elliptic,e.didJwt,e.didJwtVc,e.ethrDidResolver,e.webDidResolver,e.didResolver,e.mnid)}(this,function(e,r,t,i,n,o,s,a){function c(){return(c=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)}var u,d;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,function(e){e.Function="function",e.Event="event",e.Constructor="constructor",e.Fallback="fallback"}(u||(u={})),function(e){e.Pure="pure",e.View="view",e.NonPayable="nonpayable",e.Payable="payable"}(d||(d={}));var l,f=function(e){if("object"!=typeof e)return!1;if(0===Object.keys(e).length)return!0;for(var r=0,t=["from","to","data","value","gasPrice","gas"];r<t.length;r++)if(t[r]in e)return!0;return!1},v=function(e,r){for(var t=e.name+"(",i=e.inputs||[],n=0;n<i.length;n++){var o=i[n],s=o.type+" ";t+=s+="string"===o.type?'"'+r[n]+'"':""+r[n],i.length-1!==n&&(t+=", ")}return t+")"},p=function(e){return function(r){return{at:function(t){var i={};return function(e){return e.filter(function(e){return e.type===u.Function&&e.name&&!e.constant})}(r).forEach(function(r){r.name&&(i[r.name]=function(){var i={},n=[].slice.call(arguments),o=(r.inputs||[]).length;f(n[o])&&(i=n.splice(o,1)[0]);var s=c({},i,{to:t,function:v(r,n)});if(!e)return s;var a=n[n.length-1];return e(s,a)})}),c({},i,{abi:r,address:t})}}}},h=new r.ec("secp256k1");!function(e){e.DISCLOSURE_REQUEST="shareReq",e.DISCLOSURE_RESPONSE="shareResp",e.TYPED_DATA_SIGNATURE_REQUEST="eip712Req",e.VERIFICATION_SIGNATURE_REQUEST="verReq",e.ETH_TX_REQUEST="ethtx",e.PERSONAL_SIGN_REQUEST="personalSigReq",e.PRESENTATION_REQUEST="presentationReq"}(l||(l={}));var y=function(){function e(e){var r=e.did,i=e.address,u=e.privateKey,d=e.signer,l=e.ethrConfig,f=e.resolver;if(d?this.signer=d:u&&(this.signer=t.SimpleSigner(u)),r)this.did=r;else if(i)a.isMNID(i)&&(this.did="did:uport:"+i),i.match("^0x[0-9a-fA-F]{40}$")&&(this.did="did:ethr:"+i);else if(u){var v=h.keyFromPrivate(u),p=t.toEthereumAddress(v.getPublic("hex"));this.did="did:ethr:"+p}if(f)this.resolver=f;else{var y=n.getResolver(l||{}),E=o.getResolver();this.resolver=new s.Resolver(c({},E,y,{https:E.web}))}}e.createIdentity=function(){var e=h.genKeyPair(),r=e.getPublic("hex"),i=e.getPrivate("hex");return{did:"did:ethr:"+t.toEthereumAddress(r),privateKey:i}};var r=e.prototype;return r.signJWT=function(e,r){return this.did&&this.signer?t.createJWT(e,{issuer:this.did,signer:this.signer,alg:this.did.match("^did:uport:")||a.isMNID(this.did)?"ES256K":"ES256K-R",expiresIn:r}):Promise.reject(new Error("No Signing Identity configured"))},r.createDisclosureRequest=function(e,r){void 0===e&&(e={}),void 0===r&&(r=600);var t={};if(e.requested&&(t.requested=e.requested),e.verified&&(t.verified=e.verified),e.claims&&(t.claims=e.claims),e.notifications&&(t.permissions=["notifications"]),e.callbackUrl&&(t.callback=e.callbackUrl),e.networkId&&(t.net=e.networkId),e.rpcUrl){if(!e.networkId)return Promise.reject(new Error("rpcUrl was specified but no networkId"));t.rpc=e.rpcUrl}if(e.vc&&(t.vc=e.vc),e.exp&&(t.exp=e.exp),e.accountType){if(!(["general","segregated","keypair","none"].indexOf(e.accountType)>=0))return Promise.reject(new Error("Unsupported accountType "+e.accountType));t.act=e.accountType}return e.boxPub&&(t.boxPub=e.boxPub),this.signJWT(c({},t,{type:l.DISCLOSURE_REQUEST}),e.exp?void 0:r)},r.createVerification=function(e){return this.signJWT({sub:e.sub,claim:e.claim,exp:e.exp,vc:e.vc,callbackUrl:e.callbackUrl})},r.createVerificationSignatureRequest=function(e,r){return this.signJWT({unsignedClaim:e,sub:r.sub,riss:r.riss,aud:r.aud,vc:r.vc,callback:r.callbackUrl,type:l.VERIFICATION_SIGNATURE_REQUEST,rexp:r.rexp},r.expiresIn)},r.createTypedDataSignatureRequest=function(e,r){var t=void 0===r?{}:r,i=t.from,n=t.net,o=t.callback;try{for(var s=0,a=["types","primaryType","message","domain"];s<a.length;s++){var c=a[s];if(!e[c])throw new Error("Invalid EIP712 Request, must include '"+c+"'")}return Promise.resolve(this.signJWT({typedData:e,from:i,net:n,callback:o,type:l.TYPED_DATA_SIGNATURE_REQUEST}))}catch(e){return Promise.reject(e)}},r.createPersonalSignRequest=function(e,r){var t=void 0===r?{}:r;return this.signJWT({data:e,from:t.from,net:t.net,callback:t.callback,type:l.PERSONAL_SIGN_REQUEST})},r.createTxRequest=function(e,r){var t=void 0===r?{}:r,i=t.callbackUrl,n=t.exp,o=void 0===n?600:n,s=t.networkId,a=t.label,u={};return i&&(u.callback=i),s&&(u.net=s),a&&(u.label=a),this.signJWT(c({},u,e,{type:l.ETH_TX_REQUEST}),o)},r.createDisclosureResponse=function(e,r){void 0===e&&(e={}),void 0===r&&(r=600);try{var i=function(){return n.signJWT(c({},e,{type:l.DISCLOSURE_RESPONSE}),r)},n=this,o=function(){if(e.req)return Promise.resolve(t.verifyJWT(e.req,{resolver:n.resolver})).then(function(r){r.issuer&&(e.aud=r.issuer)})}();return Promise.resolve(o&&o.then?o.then(i):i())}catch(e){return Promise.reject(e)}},r.processDisclosurePayload=function(e){var r=e.doc,i=e.payload;try{var n=this,o=i.own,s=void 0===o?{}:o,u=i.capabilities,d=void 0===u?[]:u,l=i.nad,f=i.dad,v=i.iss,p=i.boxPub,h=i.verified,y=function(e,r){if(null==e)return{};var t,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)r.indexOf(t=o[i])>=0||(n[t]=e[t]);return n}(i,["own","capabilities","aud","req","iat","exp","type","nad","dad","iss","boxPub","verified"]),E=r.uportProfile,b=c({did:v,boxPub:p},s,void 0===E?{}:E,y);f&&(b.deviceKey=f),l&&(b.mnid=l,b.address=a.decode(l).address),1===d.length&&(b.pushToken=d[0]);var g=function(){if(h){var e=[],r=h.map(function(r){return t.verifyJWT(r,{resolver:n.resolver,audience:n.did}).catch(function(){return e.push(r),Promise.resolve(void 0)})});return Promise.resolve(Promise.all(r)).then(function(r){var t=[];r.forEach(function(e){e&&t.push(c({},e.payload,{jwt:e.jwt}))}),b.verified=t,b.invalid=e})}}();return Promise.resolve(g&&g.then?g.then(function(){return b}):b)}catch(e){return Promise.reject(e)}},r.authenticateDisclosureResponse=function(e,r){try{var i=this;return Promise.resolve(t.verifyJWT(e,{resolver:i.resolver,audience:i.did,callbackUrl:r,auth:!0})).then(function(e){var r=e.payload,n=e.doc;if(r.req)return Promise.resolve(t.verifyJWT(r.req,{resolver:i.resolver,audience:i.did})).then(function(e){var t=e.payload;if(t.type!==l.DISCLOSURE_REQUEST)throw new Error("Challenge payload type invalid: "+t.type);return i.processDisclosurePayload({payload:r,doc:n})});throw new Error("Challenge was not included in response")})}catch(e){return Promise.reject(e)}},r.verifyDisclosure=function(e){try{var r=this;return Promise.resolve(t.verifyJWT(e,{resolver:r.resolver,audience:r.did})).then(function(e){return r.processDisclosurePayload({payload:e.payload,doc:e.doc})})}catch(e){return Promise.reject(e)}},r.issueVerifiableCredential=function(e){try{return this.did&&this.signer?Promise.resolve(i.createVerifiableCredentialJwt(e,{did:this.did,signer:this.signer})):Promise.reject(new Error("No Signing Identity configured"))}catch(e){return Promise.reject(e)}},r.verifyPresentation=function(e){try{return Promise.resolve(i.verifyPresentation(e,this.resolver))}catch(e){return Promise.reject(e)}},r.contract=function(e){var r=this;return p(function(e,t){return e.function&&(e.fn=e.function),delete e.function,r.createTxRequest(e,t)}.bind(this))(e)},e}();Object.defineProperty(e,"SimpleSigner",{enumerable:!0,get:function(){return t.SimpleSigner}}),e.ContractFactory=p,e.Credentials=y});
//# sourceMappingURL=index.umd.js.map
